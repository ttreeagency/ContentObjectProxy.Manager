{namespace neos=TYPO3\Neos\ViewHelpers}
<f:layout name="BackendSubModule"/>

<f:section name="subtitle">
    <div class="neos-module-container">

        <f:if condition="{currentEntity}">
            <f:then>
                <h2>Content Object Proxy Dashboard / <em>{currentEntity}</em></h2>
            </f:then>
            <f:else>
                <h2>Content Object Proxy Dashboard</h2>
            </f:else>
        </f:if>
    </div>
</f:section>

<f:section name="content">
    <f:render partial="EntitySelector" arguments="{entities: entities}"/>
    <div class="neos-content neos-container-fluid">
        <div class="neos-row-fluid">
            <table class="neos-table">
                <thead>
                <tr>
                    <th width="45%">Entity</th>
                    <th>Identifier</th>
                    <th>Updated / Processed</th>
                </tr>
                </thead>
                <tbody>
                <f:for each="{processedEntities}" as="entity">
                    <tr>
                        <td><b>{entity.label}</b></td>
                        <td>{entity.identifier}</td>
                        <td>
                            <f:if condition="{entity.updateNodesCounter}">
                                <f:then>
                                    {entity.updateNodesCounter}/{entity.processedNodesCounter}
                                </f:then>
                                <f:else>
                                    <i class="icon-check-circle"></i> {entity.processedNodesCounter} node, but no update required
                                </f:else>
                            </f:if>

                        </td>
                    </tr>
                    <f:if condition="{entity.updatedNodes -> f:count()}">
                        <tr>
                            <td colspan="3">
                                <table class="neos-table-condensed" style="width: 100%;">
                                    <thead>
                                    <tr>
                                        <th width="25%">Updated nodes</th>
                                        <th>&nbsp;</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <f:for each="{entity.updatedNodes}" as="node">
                                        <tr>
                                            <td>{node.identifier}</td>
                                            <td>{node.path}</td>
                                        </tr>
                                    </f:for>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </f:if>
                </f:for>
                </tbody>
            </table>
        </div>
        <div class="neos-footer">
            <f:link.action action="index"
                           class="neos-button"
                           addQueryString="TRUE">Cancel
            </f:link.action>
        </div>
        <div class="fixedsticky-dummy" style="height: 72px;"></div>
    </div>
</f:section>
